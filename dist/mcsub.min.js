!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mcsub=e()}(this,function(){"use strict";var t=function t(e,i){this.config=t.mergeSettings(i),this.element=document.querySelector(e),this.form=this.element.children[0],this.submit=this.form.querySelector('button[type="submit"]'),this.url=this.form.action.replace("/post","/post-json?"),this.inputs=this.form.querySelectorAll("input"),this.response=this.element.querySelector(this.config.response),this.robot("b_"+this.config.user+"_"+this.config.list),this.init()};return t.mergeSettings=function(t){var e={user:"",list:"",callback:"cb",response:"#response",onSubmit:function(){},complete:function(){}},i=t;for(var n in i)e[n]=i[n];return e},t.setAttrs=function(t,e){for(var i in e)t.setAttribute(i,e[i])},t.prototype.robot=function(e){var i=document.createElement("input");t.setAttrs(i,{id:"robot",type:"text",tabindex:"-1",value:"",name:e,style:"position: absolute; left: -5000px;","aria-hidden":"true"}),this.form.appendChild(i)},t.prototype.init=function(){var t=this;this.form.addEventListener("submit",function(e){return t.submit(e)}),this.default()},t.prototype.default=function(){var t="/post?u="+this.config.user+"&amp;id="+this.config.list;this.form.action=this.form.action.replace("/post",t);for(var e=0;e<this.inputs.length;e++)this.inputs[e].id="mce-"+this.inputs[e].name},t.prototype.submit=function(t){if(t.preventDefault(),""!==this.form.lastChild.value)return!1;this.config.onSubmit.call(this);for(var e="",i=0;i<this.inputs.length;i++)e+="u="+this.config.user+"&id="+this.config.list+"&c="+this.config.callback+"&"+this.inputs[i].name+"="+encodeURIComponent(this.inputs[i].value);this.setScript(e)},t.prototype.setScript=function(t){var e=document.createElement("script");e.setAttribute("data-id",this.element.id),document.body.appendChild(e),this.getScript('[data-id="'+this.element.id+'"]',t)},t.prototype.getScript=function(t,e){var i=this,n=document.querySelectorAll(t);if(!n)return!1;for(var o=function(t){Promise.resolve().then(function(){t>1?n[t].parentElement.removeChild(n[t]):n[t].src=i.url+e}).then(function(){return i.success(n[t])})},s=0;s<n.length;s++)o(s)},t.prototype.success=function(t){var e=this;window[this.config.callback]=function(i){try{delete window[e.config.callback]}catch(t){window[e.config.callback]=void 0}t.parentElement.removeChild(t),e.response.innerHTML=i.msg.includes(" - ")?i.msg.substring(3):i.msg,e.config.complete.call(e)}},t});
